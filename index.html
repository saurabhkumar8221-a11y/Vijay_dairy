<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Vijay Dairy SIM Panel</title>
<style>
body{font-family:Arial;padding:20px;background:#f4f4f4}
h2{text-align:center}
.section{display:none;background:#fff;padding:15px;border-radius:10px;margin-top:15px}
input,select,button{width:100%;padding:8px;margin:5px 0}
button{background:green;color:white;border:none;border-radius:5px}
.success{color:green;font-weight:bold}
.nav button{background:#007bff;margin-bottom:10px}
</style>
</head>
<body>

<h2>Vijay Dairy SIM Management</h2>

<div class="nav">
<button onclick="showSection('user')">Add Retailer / Agent</button>
<button onclick="showSection('stock')">Add Distributor Stock</button>
<button onclick="showSection('give')">Give SIM</button>
<button onclick="showSection('mnp')">MNP/PORT Service</button>
</div>

<!-- ================= MNP/PORT SERVICE ================= -->
<div id="mnp" class="section">
<h3>MNP/PORT Service</h3>
<form id="mnpForm">

<input type="text" id="agentCode" placeholder="Agent Code" required>
<input type="text" id="agentName" placeholder="Agent Name" readonly>
<input type="tel" id="lapu" placeholder="Customer LAPU" maxlength="10" required oninput="this.value=this.value.replace(/[^0-9]/g,'')">

<select id="operator">
<option value="JIO">JIO</option>
<option value="VI">VI</option>
<option value="BSNL">BSNL</option>
</select>

<select id="requestType">
<option value="Recharge">Recharge</option>
<option value="MNP Recharge">MNP Recharge</option>
<option value="New Activation">New Activation</option>
<option value="Replacement">Replacement</option>
</select>

<input type="tel" id="customerMobile" placeholder="Customer Mobile (Optional)" maxlength="10" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
<input type="number" id="amount" placeholder="Amount (Optional)">
<input type="file" id="image">

<button type="button" onclick="submitMNP()">Submit Service</button>
</form>
<div id="mnpMsg" class="success"></div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxx12HuKYXsryDYSmbWBs-kcCFxknfGhthaHT3ASabcVhRFiqJjdHyLvGRMN_yG_gFIpQ/exec";

function showSection(id){
document.querySelectorAll('.section').forEach(sec=>sec.style.display='none');
document.getElementById(id).style.display='block';
}

showSection('user');

// Auto-fill Agent Name based on Agent Code
document.getElementById("agentCode").addEventListener("input", function(){
  let code = this.value.trim();
  if(code.length == 0){ document.getElementById("agentName").value=""; return; }
  fetch(scriptURL,{
    method:"POST",
    body:JSON.stringify({ type:"fetchAgentName", agentCode: code })
  }).then(r=>r.json()).then(res=>{
    if(res.result==="success") document.getElementById("agentName").value = res.agentName;
    else document.getElementById("agentName").value = "";
  });
});

function submitMNP(){
let agentCode=document.getElementById("agentCode").value.trim();
let lapu=document.getElementById("lapu").value.trim();
let operator=document.getElementById("operator").value;
let requestType=document.getElementById("requestType").value;
let customerMobile=document.getElementById("customerMobile").value.trim();
let amount=document.getElementById("amount").value;
let image=document.getElementById("image").files[0]?document.getElementById("image").files[0].name:"";

if(!agentCode || !lapu){ alert("Agent Code and LAPU required"); return; }

fetch(scriptURL,{
method:"POST",
body:JSON.stringify({
type:"mnp",
agentCode:agentCode,
lapu:lapu,
operator:operator,
requestType:requestType,
customerMobile:customerMobile,
amount:amount,
image:image
})
}).then(r=>r.json()).then(res=>{
if(res.result==="success"){ document.getElementById("mnpMsg").innerHTML="âœ… Service Saved"; document.getElementById("mnpForm").reset(); setTimeout(()=>{document.getElementById("mnpMsg").innerHTML="";},2000); }
else{ alert(res.message); }
});
}
</script>
</body>
</html>
