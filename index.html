<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>User Registration</title>
</head>
<body>

<h2>User Registration</h2>

<select id="userType">
<option value="">Select User Type</option>
<option>Retailer</option>
<option>Agent</option>
</select><br><br>

<input id="lapu" placeholder="LAPU (10 digit)" maxlength="10"><br><br>
<input id="contact" placeholder="Contact (10 digit)" maxlength="10"><br><br>
<input id="shopName" placeholder="Shop Name"><br><br>
<input id="owner" placeholder="Owner Name"><br><br>

<button onclick="getLocation()">Get Location</button><br><br>

<input id="latitude" placeholder="Latitude" readonly><br><br>
<input id="longitude" placeholder="Longitude" readonly><br><br>
<input id="address" placeholder="Address" readonly><br><br>
<input id="area" placeholder="Area"><br><br>

<select id="zone">
<option value="">Select Zone</option>
<option>Sarairanjan</option>
<option>Patory</option>
</select><br><br>

<select id="remarks">
<option value="">Select Remarks</option>
<option>High Volume</option>
<option>Medium Volume</option>
<option>Low Volume</option>
</select><br><br>

<button onclick="saveUser()">Save User</button>

<h3 id="msg"></h3>

<script>

const url = "https://script.google.com/macros/s/AKfycbwLYNWXfhFKzNOP-xfPM5o34Rn-K7fq3bLtt9zM1EsNwbO-E4h01Niob4GQi1eG7_3I-w/exec";

function getLocation(){
  navigator.geolocation.getCurrentPosition(function(pos){
    latitude.value = pos.coords.latitude;
    longitude.value = pos.coords.longitude;

    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude.value}&lon=${longitude.value}`)
    .then(res=>res.json())
    .then(data=>{
      address.value = data.display_name;
      area.value = data.address.village || data.address.town || data.address.city || "";
    });
  });
}

function saveUser(){

  if(!/^\d{10}$/.test(lapu.value)){
    alert("LAPU must be 10 digit number");
    return;
  }

  if(!/^\d{10}$/.test(contact.value)){
    alert("Contact must be 10 digit number");
    return;
  }

  fetch(url,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      userType:userType.value,
      lapu:lapu.value,
      contact:contact.value,
      shopName:shopName.value,
      owner:owner.value,
      latitude:latitude.value,
      longitude:longitude.value,
      address:address.value,
      area:area.value,
      zone:zone.value,
      remarks:remarks.value
    })
  })
  .then(res=>res.json())
  .then(res=>{
    msg.innerHTML=res.message;
    if(res.status=="success"){
      document.querySelectorAll("input").forEach(i=>i.value="");
    }
  })
  .catch(err=>{
    alert("Error saving user");
  });

}

</script>

</body>
</html>
