<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <script>
    function fetchName() {
      const code = document.getElementById("agentCode").value;
      google.script.run.withSuccessHandler(function(name) {
        document.getElementById("agentName").value = name;
      }).getAgentName(code);
    }

    function submitForm() {
      const file = document.getElementById("image").files[0];
      const reader = new FileReader();

      reader.onloadend = function () {
        const form = {
          agentCode: document.getElementById("agentCode").value,
          customerMobile: document.getElementById("customerMobile").value,
          operator: document.getElementById("operator").value,
          requestType: document.getElementById("requestType").value,
          amount: document.getElementById("amount").value,
          imageBase64: reader.result,
          imageType: file ? file.type : ""
        };

        google.script.run.withSuccessHandler(function(res){
          alert(res);
          location.reload();
        }).saveActivation(form);
      };

      if (file) {
        reader.readAsDataURL(file);
      } else {
        reader.onloadend();
      }
    }
  </script>
</head>
<body>
  <h2>MNP / PORT Service</h2>

  Agent Code:<br>
  <input type="text" id="agentCode" onblur="fetchName()"><br><br>

  Agent Name:<br>
  <input type="text" id="agentName" readonly><br><br>

  Customer Mobile:<br>
  <input type="number" id="customerMobile" maxlength="10"><br><br>

  Operator:<br>
  <select id="operator">
    <option>JIO</option>
    <option>VI</option>
    <option>BSNL</option>
  </select><br><br>

  Request Type:<br>
  <select id="requestType">
    <option>Recharge</option>
    <option>FRC</option>
    <option>New Activation</option>
    <option>Replacement</option>
  </select><br><br>

  Amount (Optional):<br>
  <input type="number" id="amount"><br><br>

  Upload Image (Optional):<br>
  <input type="file" id="image"><br><br>

  <button onclick="submitForm()">Submit</button>

</body>
</html>
